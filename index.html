<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Prompts Avanzado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container app-container">
        <div class="app-header">
            <h1><i class="fas fa-magic me-2"></i>Generador de Prompts Avanzado</h1>
            <p class="mb-0">Crea prompts profesionales con parámetros técnicos optimizados</p>
            
            <div class="model-selector">
                <div class="model-btn active" data-model="chatgpt"><i class="fab fa-openai me-2"></i>ChatGPT</div>
                <div class="model-btn" data-model="claude"><i class="fas fa-robot me-2"></i>Claude</div>
                <div class="model-btn" data-model="gemini"><i class="fab fa-google me-2"></i>Gemini</div>
                <div class="model-btn" data-model="perplexity"><i class="fas fa-question-circle me-2"></i>Perplexity</div>
            </div>
        </div>

        <ul class="nav nav-tabs mt-4">
            <li class="nav-item">
                <a class="nav-link active" id="basic-tab" data-bs-toggle="tab" href="#basic" role="tab" aria-controls="basic" aria-selected="true">Configuración Básica</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="advanced-tab" data-bs-toggle="tab" href="#advanced" role="tab" aria-controls="advanced" aria-selected="false">Análisis Avanzado</a>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <!-- PESTAÑA DE CONFIGURACIÓN BÁSICA -->
            <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                <div class="config-section">
                    <h4><i class="fas fa-sliders-h me-2"></i>Configuración Rápida</h4>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Nombre del Prompt</label>
                            <input type="text" class="form-control" id="promptName" placeholder="Ej: Análisis de mercado financiero">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Seleccionar preset</label>
                            <select class="form-select" id="presetSelect">
                                <option value="">Mi configuración personalizada...</option>
                                <option value="technical">Análisis Técnico</option>
                                <option value="creative">Contenido Creativo</option>
                                <option value="research">Investigación Académica</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Descripción del Prompt</label>
                        <textarea class="form-control" id="promptDescription" rows="2" placeholder="Describe para qué usarás este prompt..."></textarea>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" id="saveConfig"><i class="fas fa-save me-2"></i>Guardar Config</button>
                        <button class="btn btn-outline-secondary" id="resetConfig"><i class="fas fa-redo me-2"></i>Resetear</button>
                    </div>
                </div>

                <div class="config-section">
                    <h4><i class="fas fa-pencil-ruler me-2"></i>Estructura del Prompt</h4>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Rol <i class="fas fa-question-circle help-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Define la personalidad o el perfil que la IA debe adoptar para generar la respuesta. Un buen rol guía el tono y la calidad de la información."></i></label>
                            <input type="text" class="form-control" id="roleInput" placeholder="Ej: Experto en marketing digital...">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Tono <i class="fas fa-question-circle help-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Elige la actitud y el estilo de la respuesta. El tono puede ser formal, casual, cómico, etc."></i></label>
                            <select class="form-select" id="toneSelect">
                                <option value="profesional">Profesional</option>
                                <option value="académico">Académico</option>
                                <option value="creativo">Creativo</option>
                                <option value="técnico">Técnico</option>
                                <option value="divulgativo">Divulgativo</option>
                                <option value="other">Otra...</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Nuevo campo de texto para tono personalizado, inicialmente oculto -->
                    <div class="mb-3" id="otherToneContainer" style="display: none;">
                        <label class="form-label">Tono Personalizado</label>
                        <input type="text" class="form-control" id="otherToneInput" placeholder="Ej: informal, casual y dubitativo">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Objetivo <i class="fas fa-question-circle help-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Describe qué quieres lograr exactamente con este prompt. Un objetivo claro ayuda a la IA a no desviarse del tema."></i></label>
                        <textarea class="form-control" id="objectiveInput" rows="2" placeholder="Describe qué quieres lograr con este prompt..."></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Alcance <i class="fas fa-question-circle help-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Establece los límites y el contexto del trabajo. Define qué información debe ser incluida y cuál debe ser omitida."></i></label>
                        <textarea class="form-control" id="scopeInput" rows="2" placeholder="Define el contexto y límites del trabajo..."></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Formato de Salida <i class="fas fa-question-circle help-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Especifica cómo quieres que se presente la respuesta (ej. 'tabla', 'lista de viñetas', 'ensayo de 500 palabras')."></i></label>
                        <textarea class="form-control" id="formatInput" rows="2" placeholder="Especifica cómo quieres que se presente la respuesta..."></textarea>
                    </div>
                </div>

                <div class="config-section">
                    <h4><i class="fas fa-folder-open me-2"></i>Cargar Prompts</h4>
                    <div id="configList" class="config-list">
                        <!-- Las configuraciones guardadas se cargarán aquí -->
                        <p class="text-center text-muted">Aún no tienes configuraciones guardadas.</p>
                    </div>
                </div>
            </div>

            <!-- PESTAÑA DE ANÁLISIS AVANZADO -->
            <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                <div class="config-section">
                    <h4><i class="fas fa-project-diagram me-2"></i>Análisis por Capítulos</h4>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>Utilice esta sección para crear análisis complejos divididos en capítulos con síntesis final.
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Título del Análisis Global</label>
                        <input type="text" class="form-control" id="globalAnalysisTitle" placeholder="Ej: Análisis del mercado de vivienda 2023">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Enfoque Particular para la Síntesis Final</label>
                        <input type="text" class="form-control" id="synthesisFocus" placeholder="Ej: Perspectiva de rentabilidad para inversores">
                    </div>
                    
                    <h5 class="mt-4">Capítulos</h5>
                    <div id="chapterList" class="chapter-list">
                        <!-- Los capítulos se agregarán aquí dinámicamente -->
                    </div>
                    
                    <button class="btn btn-outline-primary mt-3" id="addChapterBtn"><i class="fas fa-plus me-2"></i>Agregar Capítulo</button>
                    
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="autoSynthesisCheck" checked>
                        <label class="form-check-label" for="autoSynthesisCheck">Generar automáticamente prompt de síntesis final</label>
                    </div>
                </div>

                <div class="config-section">
                    <h4><i class="fas fa-list-ol me-2"></i>Instrucciones de Secuencialidad</h4>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>Instrucciones para la IA para pausar o realizar el trabajo en partes.
                    </div>
                    <textarea class="form-control" id="sequentialityInput" rows="2" placeholder="Ej: Genera solo el primer capítulo y espera por mi confirmación para continuar..."></textarea>
                </div>
            </div>
        </div>

        <div class="config-section text-center">
            <button class="btn btn-primary btn-lg" id="generatePromptBtn"><i class="fas fa-bolt me-2"></i>Generar Prompt</button>
            
            <div id="generatedPrompt" class="generated-prompt mt-4 d-none">
                // El prompt generado aparecerá aquí
            </div>

            <div class="mt-3">
                <button class="btn btn-outline-success" id="copyPromptBtn"><i class="fas fa-copy me-2"></i>Copiar Prompt</button>
                <button class="btn btn-outline-primary" id="savePromptBtn"><i class="fas fa-download me-2"></i>Guardar Prompt</button>
            </div>
        </div>
    </div>

    <!-- Modals (diálogos) para confirmaciones y ayuda -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">Confirmar Eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que deseas eliminar la configuración "<span id="configNameToDelete"></span>"?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="resetConfirmModal" tabindex="-1" aria-labelledby="resetConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="resetConfirmModalLabel">Confirmar Reinicio</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que deseas restablecer todos los campos?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmResetBtn">Restablecer</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import { getFirestore, doc, getDoc, setDoc, deleteDoc, collection, query, onSnapshot, orderBy, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // Variables globales de la app, proporcionadas por el entorno de Canvas.
      const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
      const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
      const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
      
      let db = null;
      let auth = null;
      let userId = null;
    </script>
    <script src="app.js"></script>
</body>
</html>
